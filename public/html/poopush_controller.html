<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Poopush Controller (Initiator)</title>
</head>
<body>

  <h1>Poopush Controller (Initiator)</h1>

  <video id="remote-video" playsinline></video>
  <button id="connect-btn">Connect</button>
  <button id="start-lift-shovel-arm-btn">Start lift shovel arm</button>
  <button id="stop-lift-shovel-arm-btn">Stop lift shovel arm</button>
  <button id="start-video-btn">Start Video</button>
  <button id="stop-video-btn">Stop Video</button>

  <script src="https://cdn.jsdelivr.net/npm/simple-peer@9/simplepeer.min.js"></script>
  <script type="module">
    
    import poopy from '../js/poopy.js';

    poopy.controller.log_events();

    poopy.controller.addEventListener('peer-stream', (e) => {
      let video = document.getElementById('remote-video');
      video.srcObject = e.detail;
      video.play();
    });

    document.getElementById('start-video-btn').onclick = () => {
      poopy.controller.start_video();
      console.log('Poopush controller start video');
    };

    document.getElementById('stop-video-btn').onclick = () => {
      let video = document.getElementById('remote-video');
      let stream = video.srcObject;
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }
      videoEl.srcObject = null;
      poopy.controller.stop_video();
    };

    document.getElementById('connect-btn').onclick = () => {
      poopy.controller.connect();
      console.log('Poopush controller connect');
    };

    document.getElementById('start-lift-shovel-arm-btn').onclick = () => {
      poopy.controller.start_lift_shovel_arm();
      console.log('Poopush controller start lift shovel arm');
    };

    document.getElementById('stop-lift-shovel-arm-btn').onclick = () => {
      poopy.controller.stop_lift_shovel_arm();
      console.log('Poopush controller stop lift shovel arm');
    };

    document.getElementById('start-video-btn').onclick = () => {
      poopy.controller.start_video();
      console.log('Poopush controller start video');
    };

    document.getElementById('stop-video-btn').onclick = () => {
      poopush.stop_video();
      console.log('Poopush controller stop video');
    };

  </script>

</body>
</html>
